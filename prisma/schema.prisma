generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                    Int      @id @default(uuid()) 
  first_name            String?
  last_name             String?
  phone_number          String   @unique
  email                 String   @unique
  birth_date            DateTime?
  gender                String?
  bank_account_number   String?
  sheba_number          String?
  is_verified           Boolean  @default(false)
  newsletter_subscribed Boolean? @default(false)
  role                  Role     @default(CUSTOMER)
  wallet_transactions   WalletTransaction[]
  wallet_balance        Float    @default(0)
  addresses             Address[]?
  orders                Order[]?
  favorites             Product[] @relation("UserFavorites")
}

enum Role {
  ADMIN
  CUSTOMER
  CEO
}

model Address {
  id          Int     @id @default(autoincrement())
  user_id     Int
  province    String
  city        String
  street      String
  alley       String
  unit        String
  postal_code String
  user        User    @relation(fields: [user_id], references: [id])
}

model Order {
  id            Int          @id @default(autoincrement())
  order_number  String       @unique
  order_status  OrderStatus
  order_date    DateTime     @default(now())
  total_price   Float
  items         OrderItem[]
  user_id       Int
  user          User         @relation(fields: [user_id], references: [id])
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED
  CANCELLED
}

model OrderItem {
  id        Int      @id @default(autoincrement())
  order_id  Int
  product_id Int
  quantity  Int
  product   Product  @relation(fields: [product_id], references: [id])
  order     Order    @relation(fields: [order_id], references: [id])
}

model Product {
  id              Int           @id @default(autoincrement())
  name            String
  description     String
  price           Float
  is_discounted   Boolean       @default(false)
  discount_type   DiscountType
  discount_value  Float        
  is_new          Boolean       @default(true) // محصول جدید
  created_at      DateTime      @default(now())
  images          ProductImage[]
  sizes           ProductSize[]
  colors          ProductColor[]
  reviews         Review[]
  questions       Question[]
  category_id     Int
  category        Category      @relation(fields: [category_id], references: [id])
}

enum DiscountType {
  PERCENTAGE
  FLAT
}

model ProductImage {
  id        Int      @id @default(autoincrement())
  product_id Int
  url       String
  product   Product  @relation(fields: [product_id], references: [id])
}

model ProductSize {
  id        Int      @id @default(autoincrement())
  product_id Int
  size      String
  product   Product  @relation(fields: [product_id], references: [id])
}

model ProductColor {
  id        Int      @id @default(autoincrement())
  product_id Int
  color     String
  product   Product  @relation(fields: [product_id], references: [id])
}

model Category {
  id        Int       @id @default(autoincrement())
  name      String
  image_url String
  gender    Gender
  products  Product[]
}

enum Gender {
  MALE
  FEMALE
  KIDS
  UNISEX
}

model Review {
  id        Int      @id @default(autoincrement())
  product_id Int
  user_id    Int
  rating    Int     
  comment   String
  created_at DateTime @default(now())
  product   Product  @relation(fields: [product_id], references: [id])
  user      User     @relation(fields: [user_id], references: [id])
}

model Question {
  id        Int      @id @default(autoincrement())
  product_id Int
  user_id    Int
  question  String
  answer    String?
  created_at DateTime @default(now())
  product   Product  @relation(fields: [product_id], references: [id])
  user      User     @relation(fields: [user_id], references: [id])
}

model Slider {
  id        Int      @id @default(autoincrement())
  title     String
  image_url String
  link      String
  created_at DateTime @default(now())
}

model WalletTransaction {
  id        Int      @id @default(autoincrement())
  user_id    Int
  amount    Float
  type      TransactionType
  created_at DateTime @default(now())
  user      User     @relation(fields: [user_id], references: [id])
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
}
